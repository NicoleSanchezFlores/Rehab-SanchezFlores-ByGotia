```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(readr)
library(janitor)
library(tidyverse)
library(nnet)
library(knitr)
library(kableExtra)
library(broom)
library(dplyr)
library(mosaic)
library(car)
library(reshape2)
rehab <-read_csv("help.csv")
rehab <- clean_names(rehab)

rehab <- rehab |> mutate(
    prim_sub_label = factor(
      prim_sub,
      levels = 0:8,
      labels = c(
        "None",
        "Alcohol",
        "Cocaine",
        "Heroin",
        "Barbiturates",
        "Benzos",
        "Marijuana",
        "Methadone",
        "Opiates"
        )
      )
    )

rehab <- rehab |> mutate(
    home_label = factor(
      homeless,
      levels = 0:1,
      labels = c(
        "No",
        "Yes"
        )
      )
    )

rehab <- rehab |> mutate(
    gender_label = factor(
      a1,
      levels = 1:2,
      labels = c(
        "Male",
        "Female"
        )
      )
    )

#?HELPfull
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
```

# Introduction

Substance abuse and use disorders have been a major public health concern in the United States especially among those that have faced homelessness and mental health challenges. Prior research focused on the homeless population has found patterns associated with an individual's substance choice in relation to not only mental health, but also age and potentially gender. A systematic review focused on understanding drug use patterns from 2007 and 2020 found that alcohol still remains the most commonly used substance among individuals experiencing homelessness with psychoactive drug use increasing over time (Coombs et al., 2024). They also found that substance abuse was generally more common among men due to mental health and trauma stressors (Coombs et al., 2024). In relation to gender, studies have mixed results on whether gender is significantly associated association with drug use. A study conducted in a Spanish shelter assessed whether there was a statistical difference in drug consumption between homeless men and women. They found that there was not a statistically significant difference between men and women in their observed population in terms of their drug use. However, they did find that the reason for initial drug use did differ with women starting due to partner influence or lack of family affectivity while men initiated drug use because of personality or social factors (Parés-Bayerri et al., 2023). Following the thread of mental health comorbidity with drug use among those facing homelessness, a third and final study found that individuals experiencing homelessness that admit into services not only have a higher frequency of drug use, but also higher rates of mental health comorbidity. Women in this population were specifically found to be highly associated with having mental health comorbidities tied with their drug use (Arnos & Acevedo, 2023).

Given the clinical and social consequences of substance use patterns, the goal of this analysis is to assess whether demographic and psycho-social characteristics are differentially associated with primary substance choice in this clinical population. The target population for this study therefore consists of adults receiving inpatient detoxification care. Within this population, we will be evaluating a range of individual demographic and psycho-social characteristics and their associations with primary substance use.

Based on this prior research our primary question then becomes:

Does age, gender, depressive symptom scores, and homelessness predict primary substance type among adults receiving inpatient detoxification care?

To address this question, we will utilize multinomial logistic regression which is an extension of binary logistic regression due to our outcome of primary substance choice being nominal and non-ordinal (Bilder, 2015). The data that will be used in this analysis comes from the Health Evaluation and Linkage to Primary Care (HELP) study which was a clinical trial for adults receiving inpatient care at a detoxification unit in 2004. If patients did not have a primary care physician then they were randomized with the goal of linking to primary medical care. This clinical research data was approved by Institutional Review Board of Boston University Medical Center and is housed in the `mosaic` RStudio package.

For our research focus, we utilized the explanatory variables a1 (gender represented by 1 = male and 2 = female), age, homeless (related to homeless status with 0 = no and 1 = yes), and ces_d (center for epidemiological studies depression measure 0-60). Our chosen variables will help us determine the potential correlation between these factors and the chosen first drug of choice (prim_sub) for an individual in the detoxification unit. Age and CES-D scores were treated as continuous variables while gender and homelessness were treated as categorical variables.

# Data and Analysis Variables

Inclusion criteria for the present analysis consisted of adults admitted to the inpatient detoxification unit with complete data on age, gender, depressive symptom scores, homelessness status, and reported primary substance of use. Exclusion criteria included individuals with missing data on the aforementioned key variables or primary substance outcome.

During exploratory data analysis, alcohol was identified as the most frequently reported primary substance followed by cocaine and heroin. The other substance response options of none, barbiturates, benzos, methadone, and opiates were not reported (n = 0). Marijuana was also only reported once (n = 1) among the detoxification center population. Due to this sparsity within primary substance reports, the analysis was restricted to individuals that reported alcohol, cocaine, and heroin (n = 469) as their primary substance compared to the original sample size of n = 470.

Additionally, because the data was gathered in 2004 this might influence the low reported use of drugs outside of the three main categories of alcohol, cocaine, and heroin. For example, socially the use of marijuana as a main primary substance has increased overtime which is not reported in the HELP data @patrick_2025_mtf.

Given the non-ordinal and multi-category nature of the primary substance outcome, a multinomial logistic regression model was therefore selected for our analysis (Bilder, 2015). Binary logistic regression was not chosen in this instance as it would cause all substances to be collapsed into a single category which would prevent a deeper understanding of the substance-specific relationships between the explanatory variables.

# Methodological Extension: Multinomial Logistic Regression

In a multinomial logistic regression model, a base-line category must be assigned to compare the association between age, gender, CES-D depression score, and homelessness status with choice of primary substance use. Our model utilizes alcohol as the base-line reference category due to its high response prevalence (n = 185) among individuals in the detoxification center compared to cocaine (n = 156) and heroin (n = 128).

To account for only alcohol, cocaine, and heroin in the regression the HELP data was cleaned by dropping all unnecessary category outcomes from the primary substance variable.

```{r}
rehab$prim_sub_label <- droplevels(rehab$prim_sub_label)

filtered_rehab <- rehab |>
  group_by(prim_sub_label) |>
  filter(n()>1) |>
  ungroup() |>
  droplevels()

subtance_counts <- filtered_rehab |>
  count(prim_sub_label) |>
  rename(
    "Primary Substance" = prim_sub_label,
    "Number of Patients" = n
  )

kable(
  subtance_counts,
  digits = 0,
  booktabs = TRUE,
  caption = "Distribution of Primary Substances"
)|>
  kable_styling(full_width = FALSE)
```

Independence of observations was assumed, as each observation represents a unique patient admission to the detoxification unit.

Next, the multinomial logistic regression model can be set up to examine the association between age, gender, homelessness status, and CES-D depression score with primary substance while using alcohol as the reference. Let $Y_i$ denote the primary substance for detoxification patient $i$. Since alcohol is being treated as the reference category each remaining substance $j \in$ {cocaine, heroin} will be modeled as: $$log(\frac{P(Y_i = j)}{P(Y_i = alcohol)}) = \beta_{0j} + \beta_{1j}(age_i) + \beta_{2j}(gender_i) + \beta_{3j}(homeless_i) + \beta_{4j}(ces-d_i)$$ This model creates an odds ratio comparison between alcohol and cocaine or heroin as it relates to the explanatory variables to test associations.

To conduct multinomial logistic regression the `multinom()` function was used from the `nnet` package (Bruin, 2011).

```{r}
mod.fit <- multinom(formula = prim_sub_label ~ gender_label + age + home_label + ces_d, data = filtered_rehab)

summary(mod.fit)

```

The fitted multinomial logistic regression model yielded the following log-odds equations for cocaine and heroin relative to alcohol as the reference category: Cocaine vs Alcohol $$log(\frac{\hat{\pi}_{cocaine}}{\hat{\pi}_{alcohol}}) = 2.967828 + 0.5151615(gender) - 0.06541560(age) - 0.6770603(homeless) -  0.03327985(ces-d)$$ Heroin vs Alcohol $$log(\frac{\hat{\pi}_{heroin}}{\hat{\pi}_{alcohol}}) = 2.548504 + 0.2613997(gender) - 0.08280548(age) - 0.7872547(homeless) +  0.00319592(ces-d)$$ These resulting coefficients are the changes in the log odds of choosing cocaine or heroin versus alcohol for a one-unit increase in each explanatory variable while holding all other variables constant. The negative age coefficients in both models indicate that for each additional year there is an associated lower log odds of choosing cocaine versus alcohol and heroin versus alcohol. Homelessness shows a similar relationship with a "yes" response to being homeless is associated with lower log odds of cocaine and heroin use versus alcohol. However, CES-D is only negative for cocaine and not heroin indicating that depressive symptom scores are more strongly associated with decreased odds of cocaine use than heroin in this population.

# Results

```{r}
table_1 <- filtered_rehab |>
  summarise(
    Sample = n(),
    Alcohol = sum(prim_sub_label == "Alcohol", na.rm = TRUE),
    Cocaine = sum(prim_sub_label == "Cocaine", na.rm = TRUE),
    Heroin = sum(prim_sub_label == "Heroin", na.rm = TRUE),
    Age_Mean = mean(age, na.rm = TRUE),
    Age_SD = sd(age, na.rm = TRUE),
    Female_perc = mean(gender_label == "Female") *100,
    Homeless_perc = mean(home_label == "Yes") *100,
    CESD_Mean = mean(ces_d, na.rm = TRUE),
    CESD_SD = sd(ces_d, na.rm = TRUE)
  ) |>
  pivot_longer(
    cols = everything(),
    names_to = "Characteristic",
    values_to = "Value"
  )

kable(
  table_1,
  digits = 2,
  caption = "Table 1. Demographic Characterisitcs of Patient Sample (N = 469)") |>
  kable_styling(full_width = FALSE)
```

The final cleaned sample now consists of 469 adults receiving inpatient detoxification care who reported alcohol (n = 185), cocaine (n = 156), or heroin (n = 128) as their primary substance of choice. Table 1 further summarizes the demographic characteristics of the study population. 

Type II likelihood ratio tests obtained from the `car` package were used to assess whether each explanatory variable was significantly associated with primary substance choice in the fitted multinomial logistic regression model. 

```{r}
Anova(mod.fit)
```

Based on the Type II likelihood ratio tests from the fitted multinomial logistic regression model, age ($LR_{\chi^{2}}$ = 33.112, $p = 6.453e-08$), homelessness ($LR_{\chi^{2}}$ = 13.270, $p = 0.0013139$), and CES-D ($LR_{\chi^{2}}$ = 17.450, $p = 0.0001625$) are significantly associated with primary substance choice. However, gender was not statistically significant ($LR_{\chi^{2}}$ = 3.437, $p = 0.1793288$). This suggests that age, homelessness, and depressive symptom scores are important predictors of primary substance choice. Meanwhile, there is insufficient evidence to conclude that gender is associated with substance choice. 

To further assess these associations, relative risk ratios comparing cocaine and heroin to alcohol were calculated. 

```{r}
rrr_model <- tidy(mod.fit, conf.int = TRUE, exponentiate = TRUE)

rrr_model <- rrr_model |>
  mutate(
    term = case_when(
      term == "(Intercept)" ~ "Intercept",
      term == "gender_labelFemale" ~ "Female vs Male",
      term == "age" ~ "Age",
      term == "home_labelYes" ~ "Homeless (Y/N)",
      term == "ces_d" ~ "CES-D score",
      TRUE ~ term 
    )
  )

kable(
  rrr_model,
  digits = 3,
  booktabs = TRUE, 
  caption = "Relative Risk Ratios and 95 percent CI intervals for multinomial logistic regression (alcohol as reference)."
) |> kable_styling(full_width = FALSE)

```

From the relative risk ratio table, age showed a strong association with both cocaine and heroin relative to alcohol while holding gender, homelessness, and CES-D score constant. For every additional year of age, there was an associated 6.3% decrease in the relative risk of cocaine versus alcohol and we are 95% confident that the true decrease lies between 3.4% and 9.1%. There was also a 7.9% decrease in relative risk of heroin versus alcohol and we are 95% confident that the true decrease lies between 4.9% and 10.9%. This suggests that younger patients in the detoxification center are relatively more likely to report cocaine or heroin use compared to alcohol.

CES-D score also had a high association with choice of substance. For every additional 1 point score increase there is an associated 3.3% decrease in relative risk of cocaine versus alcohol with a 95% confidence interval where the true decrease lies between 1.5% and 5.1%. On the other hand, there was not a significant association between heroin versus alcohol since the risk ratio was close to one (1.003) and the confidence interval included 1 (-2.4% to 1.7%).

Homelessness status also had an association with choice of primary substance. Patients that experienced homelessness had a 49.2% lower relative risk of choosing cocaine over alcohol when compared to those that were not homeless. They also had a 95% confidence interval of 32.3% to 67.7%. When it came to heroin versus alcohol, homelessness was associated with a 54.5% lower relative risk and a 95% confidence interval of 26.4% to 71.8%.

These relative risk ratios indicate that age, CES-D score, and homelessness status meaningfully shift the relative likelihood of choosing cocaine or heroin versus alcohol. Within the detoxification center population this means that older patients and those facing homelessness are relatively more likely to report alcohol as their primary substance compared to cocaine or heroin.

While relative risk ratios quantify marginal associations, predicted probabilities were calculated to illustrate how these associations translate into absolute likelihoods of primary substance choice across the observed covariate values (Bilder, 2015).

```{r}
pi.hat <- predict(object = mod.fit, newdata = filtered_rehab, type = "probs")
head(pi.hat)

pi_frame <- as.data.frame(pi.hat)

pi_pivot <- pi_frame |>
  pivot_longer(
    cols = everything(),
    names_to = "Substance",
    values_to = "Probability"
  )

pi_table <- pi_pivot |>
  group_by(Substance) |>
  summarise(
    mean_prob = mean(Probability),
    min_prob = min(Probability),
    max_prob = max(Probability)
  )

kable(
  pi_table,
  digits = 3,
  caption = "Summary of the predicted probabilites by subtance"
) |>
  kable_styling(full_width = FALSE)

```

The table above summarizes the distribution of the predicted probabilities for each primary substance across all the patients that entered into the detoxification center. On average, alcohol had the highest average predicted probability (mean = 0.394) compared to cocaine (mean = 0.333) and heroin (mean = 0.273). Alcohol is therefore the most common predicted primary substance to be reported among the detoxification center population.

The ranges of predicted probabilities for each primary substance also reveals how individual characteristics influence the substance choice. The range for alcohol was 0.085 to 0.868 which indicates that some individuals based on their characteristics (age, gender, homelessness, and CES-D) were predicted to have a lower or higher likelihood of choosing alcohol. Similarly, the predicted probabilities ranged from 0.063 to 0.717 for cocaine and 0.043 to 0.549 for heroin. These ranges demonstrate that the explanatory variables do not affect all individuals the same. Instead they shift the relative likelihood of each substance depending on an individual's combined characteristics. 

These results are most generalizable to adults similar to those in the HELP data set who are receiving inpatient detoxification care, particularly those reporting alcohol, cocaine, and heroin as their primary substance. 

## Predicted Probabilities

## Predicted Probability Plot for Age

```{r}
newdat_age <- expand.grid(
  age = seq(min(rehab$age, na.rm = TRUE),
            max(rehab$age, na.rm = TRUE),
            by = 1),
  ces_d = mean(rehab$ces_d, na.rm = TRUE),
  gender_label = "Male",
  home_label = "Yes"
)

pp_age <- predict(mod.fit, newdata = newdat_age, type = "probs")
# now we can convert log-odds into probabilities that sum to ,so we model-estimated probabilities of each substance choice.
pp_df_age <- cbind(newdat_age, pp_age)
# no we just combining into our data set pp_df <- cbind(newdat_age, pp)

pp_long_age <- melt(
  pp_df_age,
  id.vars = "age",
  measure.vars = c("Alcohol", "Cocaine", "Heroin"),
  variable.name = "Substance",
  value.name = "Probability"
)

ggplot(pp_long_age,
       aes(x = age, y = Probability, color = Substance)) +
  geom_line(linewidth = 1) +
  labs(
    title = "Predicted Prob. of Primary Substance by Age",
    x = "Age",
    y = "Predicted Probability"
  ) +
  theme_minimal() +
  theme(
    legend.title = element_text(face = "bold"),
    plot.title = element_text(hjust = 0.5)
  )
```

-   **Findings** Figure 1 shows a model-predicted probabilities of primary substance choice across age. When holding depression, gender, and homelessness constant, older individuals are substantially more likely to report alcohol as their primary substance. Younger individuals are more likely to report cocaine as their primary substance, whereas cocaine use declines with increasing age.Heroin use as a primary substance is concentrated among younger individuals and becomes increasingly unlikely at older ages. (Add some kind of visualization)

## Predicted Probability of Primary Substance by Depression Score

```{r}
newdat_ces <- expand.grid(
  ces_d = seq(0, 60, by = 1),
  age = mean(rehab$age, na.rm = TRUE),
  gender_label = "Male",
  home_label = "Yes"
)

pp <- predict(mod.fit, newdata = newdat_ces, type = "probs")
# now we can convert log-odds into probabilities that sum to ,so we model-estimated probabilities of each substance choice.
pp_df <- cbind(newdat_ces, pp)
# no we just combining into our data set pp_df <- cbind(newdat_ces, pp)

pp_long <- melt(
  pp_df,
  id.vars = "ces_d",
  measure.vars = c("Alcohol", "Cocaine", "Heroin"),
  variable.name = "Substance",
  value.name = "Probability"
)
#ggplot need us to melt
ggplot(pp_long,
       aes(x = ces_d, y = Probability, color = Substance)) +
  geom_line(linewidth = 1) +
  labs(
    title = "Predicted Prob. of Primary Substance by Depression Score",
    x = "CES-D Score",
    y = "Predicted Probability"
  ) +
  theme_minimal() +
  theme(
    legend.title = element_text(face = "bold"),
    plot.title = element_text(hjust = 0.5)
  )

```

-   **Findings** Figure 2 visuaizes the model-predicted probabilities of primary substance choice across levels of depressive symptom scores, while holding age, gender, and homelessness constant. As CES-D scores increase, the predicted probability of alcohol as the primary substance rises, while the probability of cocaine declines more rapidly. This is in contrast to the probability of heroin where it increases somewhat steadily but remains lower than alcohol throughout the range of depression scores. These results indicate that higher depressive symptom severity is associated with having alcohol as a primary substance which may show that depression as an important predictor of substance choice for this study's population.

# Discussion

The purpose of this study was to examine whether age, gender, depression score (CES-D), and homelessness would predict primary substance type (alcohol, heroin, cocaine) among adults receiving inpatient detoxification services in the HELP study. Using multinomial logistic regression, we assessed how these factors were associated with the likelihood of selecting alcohol, cocaine, or heroin as a primary substance, while adjusting for all other variables. These findings partially answer our research question, suggesting that some demographic and psychosocial factors play an important role in substance choice, but that gender differences observed descriptively may be explained by other variables. The results are as follows:

-   **Age:** One of the strongest predictors for primary substance type was age. In the multinomial regression, increasing age was associated with a 6.3% decrease in the relative risk of cocaine versus alcohol and a 7.9% decrease in the relative risk of heroin versus alcohol, holding gender, homelessness, and CES-D constant. We can see that this pattern is further illustrated in Figure 2, which displays model-predicted probabilities across age. When depression (in this case, the `ces_d` variable\`, a measure of depressive symptoms), gender, and homelessness were held constant, older individuals were substantially more likely to report alcohol as their primary substance, while younger individuals were more likely to report cocaine or heroin. These findings suggest a pattern where cocaine and heroin drug use is more prevalent at younger ages and alcohol use is predominating at older ages.

-   **Depression score (CES-D):** Depression score was another significant predictor for primary substance type. Higher CES-D scores had an association with a lower relative risk of cocaine versus alcohol, however there was no significant association was observed for heroin versus alcohol. This is also supported by the predicted probability plot shown in Figure 1 demonstrating that as depressive symptom severity increases, alcohol becomes increasingly more likely to be the primary substance, while cocaine use declines sharply. Heroin probabilities remain relatively stable across the range of depression scores. In conjunction, these results suggest that alcohol use may be more strongly associated with higher depressive symptom burden than cocaine or heroin in this detoxification population.

-   **Gender:** Though we explored gender differences in the exploratory data analysis, gender was not determined to be a statistically significant predictor of primary substance type in the multinomial regression. Perhaps, gender differences observed could be due to or mediated by other factors such as age, depression or homeless rather than gender in itself. This is in tandem with previous literature, where Parés-Bayerri et al (Parés-Bayerri et al, 2023), found that there were no strong difference in drug type use between men and women in the homeless population but there were differences in the path towards addictive behaviors.

-   **Homelessness:** Homelessness has a significant association with primary substance type in the adjusted model. Participants experiencing homelessness had lower relative risks of cocaine and heroin compared to alcohol, indicating that alcohol was disproportionately common among homeless participants. This finding aligns with prior literature suggesting that alcohol use disorders are highly prevalent among homeless populations @arnos_acevedo_2022.

# Limitations

One glaring issue is the recency of the HELP study, which should beconsidered when interpreting the findings of this study. According to Schlunberg et al., 2022

First, the HELP study data were collected in the early 2000s, and drug use patterns have changed substantially (partly due to the decriminalization and recreational legalization use of some drugs such as marijuana). National data released in 2025 from the Monitoring the Future (MTF) Panel Study indicate major shifts in substance use prevalence and ways of consumption among young adults, including historically low levels of alcohol use and historically high levels of cannabis use, vaping, and nicotine products in 2024 (@patrick_2025_mtf). In contrast, alcohol was the dominant primary substance in the HELP dataset, suggesting that the observed patterns may reflect substance use norms at the time of data collection rather than current trends.

Second, newer substances and methods of using drugs such as vaping cannabis, nicotine pouches, delta-8 THC, and hallucinogens are not captured/noted in the HELP study. National data show sharp increases in these substances among young, early midlife, and late midlife adults between 2014 and 2024 (@patrick_2025_mtf). As a result, the generalizability of our findings to today's substance use behaviors is limited, more specifcally for younger cohorts whose substance use behaviors now differ substantially from those observed in the HELP population (who tended to be older).

Third, the HELP study population consists of adults entering inpatient detoxification services, which represents a clinically severe and highly selected group, which is inherit to this study. Substance use behaviors in this population may differ from those in the general population sampled by national surveys such as MTF, which could explain the differences in drug use behaviors. For example, while alcohol use has reached historic lows nationally across multiple age groups, it may still remain highly prevalent among individuals entering treatment, which may partially explain the strong association between age, depression, and alcohol observed in this study.

Finally, predicted probability plots are based on data generated on the model we created, where some variables are held constant. Though these plots are useful for interpretation and visualization, they may not represent actual individuals and should be interpreted as adjusted estimates rather than observed prevalences

# Future Directions

Several extensions of this analysis could further strengthen our understanding of substance use patterns in the HELP study. Future analyses using datasets that include individuals who report no primary substance could extend this approach which could prove useful in modeling both substance reporting (whethere they had a primary substance) and substance choice Another next step would be to model the probability of reporting a specific primary substance versus not reporting that substance by potentially using a series of binary logistic regression models. Another distinction could be between type of drug in terms of classes, such as depressants, stimulants, psychedelics etc.

Additionally, future analyses could examine interactions between key predictors, such as age by depression score or homelessness by gender, to investigate whether associations differ may across/within subgroups. Given prior literature noting gender and mental health differences in how different groups reach substance use addictive behaviors, interaction effects may reveal patterns not captured by these main effects alone.

Finally, there could be a more recent replication of this analysis using more recent datasets would be valuable given substantial shifts in substance use patterns over time. Applying similar modeling approaches to contemporary national surveys, such as the Monitoring the Future study, would allow for direct comparison and improve the external validity of the findings.

# Conclusion

This study examined whether age, gender, depression score, and homelessness predict primary substance type among adults entering inpatient detoxification services using the HELP study. By using multinomial logistic regression, we found that age, depression severity, and homelessness were significant predictors of primary substance choice, while gender was not associated after adjustment. Older individuals were more likely to report alcohol as their primary substance, whereas cocaine and heroin use were more common among younger individuals. Participants who had higher depression symptoms scores were associated with an increased likelihood of alcohol use when compared to cocaine, and homelessness was associated with a greater probability of alcohol use compared to other substances.

Predicted probability analyses further supported these relationships by visualizing how substance choice may shift across age and depressive symptom scores while holding other factors constant. By combining these findings both mental health and other factors such as homelessness should be considered when examining substance use patterns in treatment-seeking populations. Although the HELP data reflect substance use patterns from the early 2000s, the statisticl analyses used in this study may help with understanding how demographic and psychosocial factors shape primary substance choice rehab treatement.

\newpage

# References:
